{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/milagre-do-SIOB/src/lib/mongodb.ts"],"sourcesContent":["import { MongoClient, Db } from \"mongodb\"\n\n// Verifica se a variável MONGODB_URI (lida do .env.local) existe\nif (!process.env.MONGODB_URI) {\n  throw new Error(\"Defina a variável de ambiente MONGODB_URI em .env.local\")\n}\n\nconst uri = process.env.MONGODB_URI\nconst options = {}\nlet client: MongoClient\nlet clientPromise: Promise<MongoClient>\n\n// Declaração global para armazenar a conexão em desenvolvimento (necessário para o Next.js)\ndeclare global {\n  var _mongoClientPromise: Promise<MongoClient>\n}\n\n// Lógica para reutilizar a conexão em ambiente de desenvolvimento (evita lentidão)\nif (process.env.NODE_ENV === \"development\") {\n  if (!global._mongoClientPromise) {\n    client = new MongoClient(uri, options)\n    global._mongoClientPromise = client.connect()\n  }\n  clientPromise = global._mongoClientPromise\n} else {\n  // Em produção, cria um novo cliente a cada requisição (melhor para serverless)\n  client = new MongoClient(uri, options)\n  clientPromise = client.connect()\n}\n\n/**\n * Função que retorna a instância do banco de dados (Db) e o cliente.\n * É a única função que deve ser usada pelas rotas de API para conectar.\n * @returns {Promise<{ db: Db, client: MongoClient }>}\n */\nexport async function connectToDatabase() {\n  const client = await clientPromise\n  \n  // Extrai o nome do banco de dados da URI ou usa 'siob' como padrão\n  const dbName = new URL(uri).pathname.substring(1) || \"siob\"\n  const db = client.db(dbName)\n  \n  return { db, client }\n}\n\n// Exporta o clientPromise para uso interno (opcional)\nexport default clientPromise"],"names":[],"mappings":";;;;;;AAAA;;AAEA,iEAAiE;AACjE,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU,CAAC;AACjB,IAAI;AACJ,IAAI;AAOJ,mFAAmF;AACnF,wCAA4C;IAC1C,IAAI,CAAC,OAAO,mBAAmB,EAAE;QAC/B,SAAS,IAAI,sHAAW,CAAC,KAAK;QAC9B,OAAO,mBAAmB,GAAG,OAAO,OAAO;IAC7C;IACA,gBAAgB,OAAO,mBAAmB;AAC5C;;AAWO,eAAe;IACpB,MAAM,SAAS,MAAM;IAErB,mEAAmE;IACnE,MAAM,SAAS,IAAI,IAAI,KAAK,QAAQ,CAAC,SAAS,CAAC,MAAM;IACrD,MAAM,KAAK,OAAO,EAAE,CAAC;IAErB,OAAO;QAAE;QAAI;IAAO;AACtB;uCAGe","debugId":null}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/milagre-do-SIOB/src/pages/api/logs/bootstrap.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from \"next\";\nimport { connectToDatabase } from \"@/lib/mongodb\";\nimport { IAuditoriaLog } from \"@/types/logs\";\n\n// Define a estrutura da resposta da API\ntype Data = {\n  success: boolean;\n  message: string;\n  insertedId?: string;\n  error?: string;\n};\n\n// Esta é a função default (padrão) que o Next.js procura e executa.\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<Data>\n) {\n  // 1. CHECAGEM DO MÉTODO: Apenas aceita POST\n  if (req.method !== \"POST\") {\n    return res.status(405).json({ success: false, message: \"Apenas método POST é permitido para esta rota de teste.\" });\n  }\n\n  try {\n    // 2. CONECTA AO BANCO DE DADOS\n    // A função connectToDatabase() usa a MONGODB_URI do seu .env.local\n    const { db } = await connectToDatabase();\n\n    // 3. DEFINE A COLEÇÃO\n    const collection = db.collection<IAuditoriaLog>(\"auditoria_log\");\n\n    // 4. CRIA UM NOVO DOCUMENTO (DADOS DE TESTE)\n    const testLog: IAuditoriaLog = {\n      data_hora: new Date(),\n      usuario_nome: \"Marcelo Negrão (Teste Bootstrap)\",\n      acao_tipo: \"LOGIN\",\n      modulo: \"Sistema\",\n      recurso_tabela: \"usuario\",\n      recurso_id: \"Ficticio-ID-001\",\n      descricao: \"Usuário de teste realizou login inicial no sistema SIOB.\",\n      dados_anteriores: {},\n      dados_posteriores: { status: \"Online\" },\n    };\n\n    // 5. INSERE O DOCUMENTO\n    const result = await collection.insertOne(testLog);\n\n    // 6. Resposta de sucesso\n    if (result.acknowledged) {\n      res.status(201).json({\n        success: true,\n        message: \"Log de auditoria de teste inserido com sucesso!\",\n        insertedId: result.insertedId.toHexString(),\n      });\n    } else {\n      res.status(500).json({ success: false, message: \"Falha ao inserir documento.\" });\n    }\n\n  } catch (error) {\n    // 7. Resposta de erro (ex: falha de conexão com o MongoDB)\n    console.error(\"Erro no bootstrap:\", error);\n    res.status(500).json({ success: false, message: \"Erro interno do servidor ao conectar ou inserir dados.\", error: (error as Error).message });\n  }\n}"],"names":[],"mappings":";;;;AACA;;AAYe,eAAe,QAC5B,GAAmB,EACnB,GAA0B;IAE1B,4CAA4C;IAC5C,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;YAAO,SAAS;QAA0D;IACnH;IAEA,IAAI;QACF,+BAA+B;QAC/B,mEAAmE;QACnE,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,mIAAiB;QAEtC,sBAAsB;QACtB,MAAM,aAAa,GAAG,UAAU,CAAgB;QAEhD,6CAA6C;QAC7C,MAAM,UAAyB;YAC7B,WAAW,IAAI;YACf,cAAc;YACd,WAAW;YACX,QAAQ;YACR,gBAAgB;YAChB,YAAY;YACZ,WAAW;YACX,kBAAkB,CAAC;YACnB,mBAAmB;gBAAE,QAAQ;YAAS;QACxC;QAEA,wBAAwB;QACxB,MAAM,SAAS,MAAM,WAAW,SAAS,CAAC;QAE1C,yBAAyB;QACzB,IAAI,OAAO,YAAY,EAAE;YACvB,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBACnB,SAAS;gBACT,SAAS;gBACT,YAAY,OAAO,UAAU,CAAC,WAAW;YAC3C;QACF,OAAO;YACL,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,SAAS;gBAAO,SAAS;YAA8B;QAChF;IAEF,EAAE,OAAO,OAAO;QACd,2DAA2D;QAC3D,QAAQ,KAAK,CAAC,sBAAsB;QACpC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;YAAO,SAAS;YAA0D,OAAO,AAAC,MAAgB,OAAO;QAAC;IAC5I;AACF","debugId":null}}]
}